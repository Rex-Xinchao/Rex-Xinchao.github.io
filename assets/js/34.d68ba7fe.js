(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{398:function(t,s,n){"use strict";n.r(s);var a=n(42),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h3",{attrs:{id:"docker-发布-web-服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-发布-web-服务"}},[t._v("#")]),t._v(" docker 发布 web 服务")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("准备文件\nDockerfile 文件 && 程序代码 && nginx.conf")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),n("ul",[n("li",[t._v("因为要支持 https 和域名的缘故，别忘了配置 ssl 协议")]),t._v(" "),n("li",[t._v("nginx.conf 的用户指定 nginx (useradd nginx 要不要执行这个命令手动添加用户，待确认)")])])])]),t._v(" "),n("li",[n("p",[t._v("进入服务器目录并生成镜像")])])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/home/frontend\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## demo是镜像名称")]),t._v("\ndocker image build ./ -t demo:1.0.0\n")])])]),n("ul",[n("li",[t._v("生成并启动容器")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("docker container create --name demo -p "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":80 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(":443 demo:1.0.0\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 参数说明")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## -80:80 第一个3000是终端端口，第二个容器端口")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## -443:443 https的协议要用到ssl-443端口")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## -demo 第一个是容器名称，第二个是镜像名称")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 查看全部容器")]),t._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -a\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 启动容器")]),t._v("\ndocker container start xxxxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("容器id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 进入容器")]),t._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it xxxxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("容器id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" /bin/sh\n")])])]),n("ul",[n("li",[t._v("文件展示")])]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("dockerfile")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("FROM nginx:1.17.9-alpine\n\nCOPY web /usr/share/nginx/html\nCOPY nginx.conf /etc/nginx/nginx.conf\nCOPY server.crt /etc/nginx/cert/server.crt\nCOPY server.key /etc/nginx/cert/server.key\n\nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("/tcp\n\nCMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-g"')]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"daemon off;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n")])])])]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("nginx.conf")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("user nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nworker_processes auto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\npid /run/nginx.pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tworker_connections "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("768")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# multi_accept on;")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tsendfile on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tkeepalive_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\tinclude /etc/nginx/mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tdefault_type application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\tserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name rexsun.site www.rexsun.site"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tssl on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tssl_certificate cert/server.crt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tssl_certificate_key cert/server.key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tssl_session_timeout 5m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tssl_protocols TLSv1 TLSv1.1 TLSv1.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("aNULL:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("MD5:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("RC4:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("DHE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tssl_prefer_server_ciphers on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;')]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#add_header X-Frame-Options DENY;")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#add_header X-Content-Type-Options nosniff;")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#add_header X-Xss-Protection 1;")]),t._v("\n\n\t\tlocation /api/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            proxy_pass http://121.36.201.82:3000/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tproxy_set_header Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tproxy_set_header X-Real-IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tproxy_set_header X-Forwarded-For "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t\tlocation / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   /usr/share/nginx/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name rexsun.site www.rexsun.site"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t\tlocation /api/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            proxy_pass http://121.36.201.82:3000/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tproxy_set_header Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tproxy_set_header X-Real-IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\tproxy_set_header X-Forwarded-For "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t\tlocation / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   /usr/share/nginx/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);